<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Xamarin.Forms Photo Collage with Skiasharp</title>
<meta name="description" content="I came across SkiaSharpImageMerger project in Github and was inspired to try out a Xamarin.Forms app that leverages Skiasharp to generate a simple collage im...">
<meta name="propeller" content="4156bd606050b80ed908d6ff4c60777e">
<link rel="stylesheet" href="/css/main.css">
<link rel="canonical" href="http://sreerajpr.com/blogs/xamarin-forms-photo-collage-skiasharp/">
<link rel="alternate" type="application/rss+xml" title="Sreeraj P R" href="http://sreerajpr.com/feed.xml" />

<link rel="apple-touch-icon" sizes="180x180" href="/favicon_io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon_io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon_io/favicon-16x16.png">
<link rel="manifest" href="/favicon_io/site.webmanifest">

<script data-ad-client="ca-pub-6797147217316292" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-172938344-1', 'auto');
  ga('send', 'pageview');
</script>

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Xamarin.Forms Photo Collage with Skiasharp | Sreeraj P R</title>
<meta name="generator" content="Jekyll v3.6.3" />
<meta property="og:title" content="Xamarin.Forms Photo Collage with Skiasharp" />
<meta name="author" content="Sreeraj P R" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Xamarin.Forms sample application to generate a photo collage using Skiasharp. Choose 1 to 9 photos and generate a photocard / photogrid with them. Export this photo card to other apps." />
<meta property="og:description" content="Xamarin.Forms sample application to generate a photo collage using Skiasharp. Choose 1 to 9 photos and generate a photocard / photogrid with them. Export this photo card to other apps." />
<link rel="canonical" href="http://sreerajpr.com/blogs/xamarin-forms-photo-collage-skiasharp/" />
<meta property="og:url" content="http://sreerajpr.com/blogs/xamarin-forms-photo-collage-skiasharp/" />
<meta property="og:site_name" content="Sreeraj P R" />
<meta property="og:image" content="http://sreerajpr.com/images/photoCollage.gif" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-15T00:00:00+05:30" />
<script type="application/ld+json">
{"headline":"Xamarin.Forms Photo Collage with Skiasharp","url":"http://sreerajpr.com/blogs/xamarin-forms-photo-collage-skiasharp/","dateModified":"2020-08-15T00:00:00+05:30","datePublished":"2020-08-15T00:00:00+05:30","mainEntityOfPage":{"@type":"WebPage","@id":"http://sreerajpr.com/blogs/xamarin-forms-photo-collage-skiasharp/"},"image":"http://sreerajpr.com/images/photoCollage.gif","author":{"@type":"Person","name":"Sreeraj P R"},"description":"Xamarin.Forms sample application to generate a photo collage using Skiasharp. Choose 1 to 9 photos and generate a photocard / photogrid with them. Export this photo card to other apps.","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body>
  <header class="site-header">
  <div class="container">
    <input type="checkbox" id="toggleNavbar">
    <label for="toggleNavbar" role="button" class="toggle-navbar-button">
      <i class="icon icon-menu"></i>
      <i class="icon icon-cross"></i>
    </label>
    <nav class="navbar">
      <ul>
        <li><a href="/" title="Home">Home</a></li>
        
          <li><a href="/about" title="About">About</a></li>
        
          <li><a href="/blog" title="Blog">Blog</a></li>
        
        <li><a href="/feed.xml" target="_blank"><i class="icon icon-rss"></i></a></li>
      </ul>
    </nav>
  </div>
</header>


<main class="main-container">
  <div class="container">
    <article role="article">

  <div class="card">
    <header class="post-header">
      <h1 class="post-title">Xamarin.Forms Photo Collage with Skiasharp</h1>
      <em class="post-meta">
        <time>Aug 15, 2020</time>
      </em>
    </header>

    <div class="post-content">
      <!--Commenting out the image that get's shown by default. Image can be added as asset whereever required.-->
     <!-- 
        <figure class="post-thumbnail ">
          <img src="/images/photoCollage.gif" alt="Xamarin.Forms Photo Collage with Skiasharp">
        </figure>
       -->
      <p>I came across <a href="https://github.com/mattleibow/SkiaSharpImageMerger">SkiaSharpImageMerger</a> project in Github and was inspired to try out a Xamarin.Forms app that leverages Skiasharp to generate a simple collage image. <a href="https://github.com/sreerajPR/XamarinFormsPhotoCollageSkiasharp">Link to Github repo</a>. Here is the result.</p>

<p style="text-align: center;"><img src="/images/photoCollage.gif" alt="Xamarin.Forms App Skiasharp Photo Colllage" /></p>

<p>Collaged image generation is done by the <code class="highlighter-rouge">ImageMergerHelper. Combine ( List&lt;string&gt; files)</code> method in <a href="https://github.com/sreerajPR/XamarinFormsPhotoCollageSkiasharp/blob/master/PhotoGridCreator/Helpers/ImageMergerHelper.cs#L14">ImageMergerHelper static class.</a> Let us analyse on a higher-level what is happening here. This method accepts a list of <code class="highlighter-rouge">strings</code> (paths of image files to be collaged) and returns the path to the collaged image.</p>

<h3 id="imagemergerhelper-helper-class-to-generate-collaged-image">ImageMergerHelper: Helper class to generate collaged image</h3>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">Combine</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">files</span><span class="p">)</span>
<span class="p">{</span>
	<span class="c1">//read all images into memory</span>
	<span class="n">List</span><span class="p">&lt;</span><span class="n">SKBitmap</span><span class="p">&gt;</span> <span class="n">images</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">SKBitmap</span><span class="p">&gt;();</span>
	<span class="n">SKImage</span> <span class="n">finalImage</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
	<span class="n">List</span><span class="p">&lt;</span><span class="n">SKRect</span><span class="p">&gt;</span> <span class="n">outputRects</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">SKRect</span><span class="p">&gt;();</span>
	<span class="n">List</span><span class="p">&lt;</span><span class="n">SKRect</span><span class="p">&gt;</span> <span class="n">croppingRects</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">SKRect</span><span class="p">&gt;();</span>
	<span class="n">SKImageInfo</span> <span class="n">newCanvasInfo</span><span class="p">;</span>
	<span class="n">List</span><span class="p">&lt;</span><span class="n">SKSizeI</span><span class="p">&gt;</span> <span class="n">inputSizes</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">SKSizeI</span><span class="p">&gt;();</span>
	<span class="k">try</span>
	<span class="p">{</span>
		<span class="k">foreach</span> <span class="p">(</span><span class="kt">string</span> <span class="n">image</span> <span class="k">in</span> <span class="n">files</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="c1">//create a bitmap from the file and add it to the list</span>
			<span class="n">SKBitmap</span> <span class="n">bitmap</span> <span class="p">=</span> <span class="n">SKBitmap</span><span class="p">.</span><span class="nf">Decode</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>
			<span class="n">inputSizes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">bitmap</span><span class="p">.</span><span class="n">Info</span><span class="p">.</span><span class="n">Size</span><span class="p">);</span>
			<span class="n">images</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">bitmap</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="nf">CalculateDimesnions</span><span class="p">(</span><span class="n">inputSizes</span><span class="p">,</span> <span class="k">out</span> <span class="n">outputRects</span><span class="p">,</span> <span class="k">out</span> <span class="n">croppingRects</span><span class="p">,</span> <span class="k">out</span> <span class="n">newCanvasInfo</span><span class="p">);</span>
		<span class="c1">//get a surface so we can draw an image</span>
		<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">tempSurface</span> <span class="p">=</span> <span class="n">SKSurface</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">newCanvasInfo</span><span class="p">))</span>
		<span class="p">{</span>
			<span class="c1">//get the drawing canvas of the surface</span>
			<span class="kt">var</span> <span class="n">canvas</span> <span class="p">=</span> <span class="n">tempSurface</span><span class="p">.</span><span class="n">Canvas</span><span class="p">;</span>
			<span class="c1">//set background color</span>
			<span class="n">canvas</span><span class="p">.</span><span class="nf">Clear</span><span class="p">(</span><span class="n">borderColor</span><span class="p">);</span>
			<span class="kt">int</span> <span class="n">position</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
			<span class="k">foreach</span> <span class="p">(</span><span class="n">SKBitmap</span> <span class="n">image</span> <span class="k">in</span> <span class="n">images</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">SKRect</span> <span class="n">rect</span> <span class="p">=</span> <span class="n">outputRects</span><span class="p">[</span><span class="n">position</span><span class="p">];</span>
				<span class="n">SKRect</span> <span class="n">cropRect</span> <span class="p">=</span> <span class="n">croppingRects</span><span class="p">[</span><span class="n">position</span><span class="p">];</span>
				<span class="n">position</span><span class="p">++;</span>
				<span class="n">canvas</span><span class="p">.</span><span class="nf">DrawBitmap</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cropRect</span><span class="p">,</span> <span class="n">rect</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="c1">// return the surface as a manageable image</span>
			<span class="n">finalImage</span> <span class="p">=</span> <span class="n">tempSurface</span><span class="p">.</span><span class="nf">Snapshot</span><span class="p">();</span>
		<span class="p">}</span>
		<span class="c1">//return the image that was just drawn</span>
		<span class="kt">string</span> <span class="n">documentBasePath</span> <span class="p">=</span> <span class="n">Environment</span><span class="p">.</span><span class="nf">GetFolderPath</span><span class="p">(</span><span class="n">Environment</span><span class="p">.</span><span class="n">SpecialFolder</span><span class="p">.</span><span class="n">LocalApplicationData</span><span class="p">);</span>
		<span class="kt">string</span> <span class="n">filePath</span> <span class="p">=</span> <span class="n">documentBasePath</span> <span class="p">+</span> <span class="s">"/collageImage.png"</span><span class="p">;</span>
		<span class="c1">//save the new image</span>
		<span class="k">using</span> <span class="p">(</span><span class="n">SKData</span> <span class="n">encoded</span> <span class="p">=</span> <span class="n">finalImage</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="n">SKEncodedImageFormat</span><span class="p">.</span><span class="n">Png</span><span class="p">,</span> <span class="m">100</span><span class="p">))</span>
		<span class="k">using</span> <span class="p">(</span><span class="n">Stream</span> <span class="n">outFile</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="nf">OpenWrite</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span>
		<span class="p">{</span>
			<span class="n">encoded</span><span class="p">.</span><span class="nf">SaveTo</span><span class="p">(</span><span class="n">outFile</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">filePath</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">finally</span>
	<span class="p">{</span>
		<span class="c1">//clean up memory</span>
		<span class="k">foreach</span> <span class="p">(</span><span class="n">SKBitmap</span> <span class="n">image</span> <span class="k">in</span> <span class="n">images</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">image</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>This method is pretty simple. It reads all the input images and creates <em><code class="highlighter-rouge">SKBitmap</code></em>s with them. Then it calculates some dimensions in <em><code class="highlighter-rouge">CalculateDimesnions</code></em> method.</p>
<ul>
  <li><code class="highlighter-rouge">outputRects</code>: <code class="highlighter-rouge">SKRect</code>s of each image in the <code class="highlighter-rouge">SKCanvas</code> of new image collage.</li>
  <li><code class="highlighter-rouge">croppingRects</code>: <code class="highlighter-rouge">SKRect</code>s which defines what is the cropping rectangle for each image. This is done to respect the aspect ratios of the original images. The result will be the same as <code class="highlighter-rouge">AspectFill</code> in Xamarin.Forms <code class="highlighter-rouge">Image</code>s.</li>
  <li><code class="highlighter-rouge">newCanvasInfo</code>: <code class="highlighter-rouge">SKImageInfo</code> of the new canvas, mainly to specify what should be the size of the new canvas to be created.</li>
</ul>

<p>We will see how they are calculated in the next code snippet. A <code class="highlighter-rouge">SKCanvas</code> is created with <code class="highlighter-rouge">newCanvasInfo</code> and is painted with <code class="highlighter-rouge">borderColor</code>. This is the colour of the collage frame. Then we draw the cropped portion of each  image to the canvas at corresponding <code class="highlighter-rouge">outputRects</code>. <em>Voila</em>, our collage canvas is ready to be exported. It’s exported as a png image and the path to this file is returned by the method. Let’s explore <code class="highlighter-rouge">CalculateDimesnions()</code> now</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">CalculateDimesnions</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">SKSizeI</span><span class="p">&gt;</span> <span class="n">inputSizes</span><span class="p">,</span> <span class="k">out</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">SKRect</span><span class="p">&gt;</span> <span class="n">outputRects</span><span class="p">,</span> <span class="k">out</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">SKRect</span><span class="p">&gt;</span> <span class="n">croppingRects</span><span class="p">,</span> <span class="k">out</span> <span class="n">SKImageInfo</span> <span class="n">newCanvasInfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">outputRects</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">SKRect</span><span class="p">&gt;();</span>
	<span class="n">croppingRects</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">SKRect</span><span class="p">&gt;();</span>
	<span class="kt">float</span> <span class="n">screenWidth</span> <span class="p">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">DeviceDisplay</span><span class="p">.</span><span class="n">MainDisplayInfo</span><span class="p">.</span><span class="n">Width</span><span class="p">;</span>
	<span class="kt">float</span> <span class="n">singleImageDimension</span> <span class="p">=</span> <span class="n">screenWidth</span> <span class="p">-</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
	<span class="kt">float</span> <span class="n">doubleImageDimension</span> <span class="p">=</span> <span class="p">(</span><span class="n">screenWidth</span> <span class="p">/</span> <span class="m">2</span><span class="p">)</span> <span class="p">-</span> <span class="p">((</span><span class="kt">float</span><span class="p">)(</span><span class="m">1.5</span><span class="p">)</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
	<span class="kt">float</span> <span class="n">tripleImageDimension</span> <span class="p">=</span> <span class="p">(</span><span class="n">screenWidth</span> <span class="p">/</span> <span class="m">3</span><span class="p">)</span> <span class="p">-</span> <span class="p">((</span><span class="m">4f</span> <span class="p">/</span> <span class="m">3f</span><span class="p">)</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
	<span class="n">newCanvasInfo</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SKImageInfo</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">screenWidth</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">screenWidth</span><span class="p">);</span>
	<span class="c1">//If selected images are more than one, they are cropped so as to have square aspect ratio</span>
	<span class="c1">//as each slot in the photogrid has square aspect ratio. If it is a single image, original aspect ratio is respectd.</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">inputSizes</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">1</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">foreach</span> <span class="p">(</span><span class="n">SKSize</span> <span class="n">inputSize</span> <span class="k">in</span> <span class="n">inputSizes</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="kt">float</span> <span class="n">cropRectDimensionSize</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Min</span><span class="p">(</span><span class="n">inputSize</span><span class="p">.</span><span class="n">Width</span><span class="p">,</span> <span class="n">inputSize</span><span class="p">.</span><span class="n">Height</span><span class="p">);</span>
			<span class="kt">float</span> <span class="n">cropRectX</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">cropRectY</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">cropRectDimensionSize</span> <span class="p">&lt;</span> <span class="n">inputSize</span><span class="p">.</span><span class="n">Height</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">cropRectY</span> <span class="p">=</span> <span class="p">(</span><span class="n">inputSize</span><span class="p">.</span><span class="n">Height</span> <span class="p">-</span> <span class="n">cropRectDimensionSize</span><span class="p">)</span> <span class="p">/</span> <span class="m">2f</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">cropRectDimensionSize</span> <span class="p">&lt;</span> <span class="n">inputSize</span><span class="p">.</span><span class="n">Width</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">cropRectX</span> <span class="p">=</span> <span class="p">(</span><span class="n">inputSize</span><span class="p">.</span><span class="n">Width</span> <span class="p">-</span> <span class="n">cropRectDimensionSize</span><span class="p">)</span> <span class="p">/</span> <span class="m">2f</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">croppingRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">cropRectX</span><span class="p">,</span> <span class="n">cropRectY</span><span class="p">,</span> <span class="n">cropRectDimensionSize</span><span class="p">,</span> <span class="n">cropRectDimensionSize</span><span class="p">));</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">inputSizes</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">case</span> <span class="m">1</span><span class="p">:</span>
			<span class="kt">float</span> <span class="n">scale</span> <span class="p">=</span> <span class="n">inputSizes</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Width</span> <span class="p">/</span> <span class="n">singleImageDimension</span><span class="p">;</span>
			<span class="kt">float</span> <span class="n">firstImageHeight</span> <span class="p">=</span> <span class="n">inputSizes</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Height</span> <span class="p">/</span> <span class="n">scale</span><span class="p">;</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">singleImageDimension</span><span class="p">,</span> <span class="n">firstImageHeight</span><span class="p">));</span>
			<span class="n">newCanvasInfo</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SKImageInfo</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">screenWidth</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">firstImageHeight</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">)));</span>
			<span class="n">croppingRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">inputSizes</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Width</span><span class="p">,</span> <span class="n">inputSizes</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Height</span><span class="p">));</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="m">2</span><span class="p">:</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">));</span>
			<span class="kt">float</span> <span class="n">secondImageXPosition</span> <span class="p">=</span> <span class="n">doubleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">secondImageXPosition</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">));</span>
			<span class="n">newCanvasInfo</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SKImageInfo</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">screenWidth</span><span class="p">,</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">borderWidth</span> <span class="p">*</span> <span class="m">2</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">doubleImageDimension</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="m">3</span><span class="p">:</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">));</span>
			<span class="n">secondImageXPosition</span> <span class="p">=</span> <span class="n">doubleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">secondImageXPosition</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">));</span>
			<span class="kt">float</span> <span class="n">secondImageYPosition</span> <span class="p">=</span> <span class="n">doubleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">secondImageYPosition</span><span class="p">,</span> <span class="n">singleImageDimension</span><span class="p">,</span> <span class="n">singleImageDimension</span><span class="p">));</span>
			<span class="n">newCanvasInfo</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SKImageInfo</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">screenWidth</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">secondImageYPosition</span> <span class="p">+</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">singleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">borderWidth</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="m">4</span><span class="p">:</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">));</span>
			<span class="n">secondImageXPosition</span> <span class="p">=</span> <span class="n">doubleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">secondImageXPosition</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">));</span>
			<span class="n">secondImageYPosition</span> <span class="p">=</span> <span class="n">doubleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">secondImageYPosition</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">));</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">secondImageXPosition</span><span class="p">,</span> <span class="n">secondImageYPosition</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">));</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="m">5</span><span class="p">:</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">));</span>
			<span class="n">secondImageXPosition</span> <span class="p">=</span> <span class="n">doubleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">secondImageXPosition</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">));</span>
			<span class="n">secondImageYPosition</span> <span class="p">=</span> <span class="n">doubleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">secondImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="kt">float</span> <span class="n">secondImageInSecondRowXPosition</span> <span class="p">=</span> <span class="n">tripleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">secondImageInSecondRowXPosition</span><span class="p">,</span> <span class="n">secondImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="kt">float</span> <span class="n">thirdImageInSecondRowXPosition</span> <span class="p">=</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">tripleImageDimension</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="m">3</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">thirdImageInSecondRowXPosition</span><span class="p">,</span> <span class="n">secondImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">newCanvasInfo</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SKImageInfo</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">screenWidth</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">secondImageYPosition</span> <span class="p">+</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">tripleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">borderWidth</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="m">6</span><span class="p">:</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">secondImageXPosition</span> <span class="p">=</span> <span class="n">tripleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">secondImageXPosition</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="kt">float</span> <span class="n">thirdImageXPosition</span> <span class="p">=</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">tripleImageDimension</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="m">3</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">thirdImageXPosition</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">secondImageYPosition</span> <span class="p">=</span> <span class="n">tripleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">secondImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">secondImageXPosition</span><span class="p">,</span> <span class="n">secondImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">thirdImageXPosition</span><span class="p">,</span> <span class="n">secondImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">newCanvasInfo</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SKImageInfo</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">screenWidth</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">secondImageYPosition</span> <span class="p">+</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">tripleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">borderWidth</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="m">7</span><span class="p">:</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">));</span>
			<span class="n">secondImageXPosition</span> <span class="p">=</span> <span class="n">doubleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">secondImageXPosition</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">));</span>
			<span class="n">secondImageYPosition</span> <span class="p">=</span> <span class="n">doubleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">secondImageYPosition</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">));</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">secondImageXPosition</span><span class="p">,</span> <span class="n">secondImageYPosition</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">));</span>
			<span class="kt">float</span> <span class="n">thirdImageYPosition</span> <span class="p">=</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">doubleImageDimension</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="m">3</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">thirdImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="kt">float</span> <span class="n">secondImageInThirdRowXPosition</span> <span class="p">=</span> <span class="n">tripleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">secondImageInThirdRowXPosition</span><span class="p">,</span> <span class="n">thirdImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">thirdImageXPosition</span> <span class="p">=</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">tripleImageDimension</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="m">3</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">thirdImageXPosition</span><span class="p">,</span> <span class="n">thirdImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">newCanvasInfo</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SKImageInfo</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">screenWidth</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">thirdImageYPosition</span> <span class="p">+</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">tripleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">borderWidth</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="m">8</span><span class="p">:</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">));</span>
			<span class="n">secondImageXPosition</span> <span class="p">=</span> <span class="n">doubleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">secondImageXPosition</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">,</span> <span class="n">doubleImageDimension</span><span class="p">));</span>
			<span class="n">secondImageYPosition</span> <span class="p">=</span> <span class="n">doubleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">secondImageInSecondRowXPosition</span> <span class="p">=</span> <span class="n">tripleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">secondImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">secondImageInSecondRowXPosition</span><span class="p">,</span> <span class="n">secondImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">thirdImageInSecondRowXPosition</span> <span class="p">=</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">tripleImageDimension</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="m">3</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">thirdImageInSecondRowXPosition</span><span class="p">,</span> <span class="n">secondImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">thirdImageYPosition</span> <span class="p">=</span> <span class="p">(</span><span class="n">tripleImageDimension</span> <span class="p">+</span> <span class="n">doubleImageDimension</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="m">3</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">thirdImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">secondImageInSecondRowXPosition</span><span class="p">,</span> <span class="n">thirdImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">thirdImageInSecondRowXPosition</span><span class="p">,</span> <span class="n">thirdImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">newCanvasInfo</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SKImageInfo</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">screenWidth</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">thirdImageYPosition</span> <span class="p">+</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">tripleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">borderWidth</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="m">9</span><span class="p">:</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">secondImageXPosition</span> <span class="p">=</span> <span class="n">tripleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">secondImageXPosition</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">thirdImageXPosition</span> <span class="p">=</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">tripleImageDimension</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="m">3</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">thirdImageXPosition</span><span class="p">,</span> <span class="n">borderWidth</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">secondImageYPosition</span> <span class="p">=</span> <span class="n">tripleImageDimension</span> <span class="p">+</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">secondImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">secondImageXPosition</span><span class="p">,</span> <span class="n">secondImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">thirdImageXPosition</span><span class="p">,</span> <span class="n">secondImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">thirdImageYPosition</span> <span class="p">=</span> <span class="p">(</span><span class="m">2</span> <span class="p">*</span> <span class="n">tripleImageDimension</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="m">3</span> <span class="p">*</span> <span class="n">borderWidth</span><span class="p">);</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">borderWidth</span><span class="p">,</span> <span class="n">thirdImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">secondImageXPosition</span><span class="p">,</span> <span class="n">thirdImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="n">outputRects</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">SKRect</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">thirdImageXPosition</span><span class="p">,</span> <span class="n">thirdImageYPosition</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">,</span> <span class="n">tripleImageDimension</span><span class="p">));</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">default</span><span class="p">:</span>
			<span class="k">throw</span> <span class="p">(</span><span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"Cannot merge more than 9 images."</span><span class="p">));</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Here, we first calculate the cropping rectangles for each image. Since we want <em>AspectFill</em> like feature, we take the smaller dimension from the height and width of the original image as the edge size of the cropping rectangle. Next, we calculate the outputrects for each image. Dimensions of each image is calculated so that the total width of the collaged image will match the device screen width. We have a unique layout defined for the photocard based on the number of input images in that loooong switch-case.</p>

<p>In the <a href="https://github.com/sreerajPR/XamarinFormsPhotoCollageSkiasharp">sample application</a>, <em>Xamarin.Essentials</em> has been used for handling permissions, sharing the image to other apps and <em>Xam.Plugin.Media</em> for picking up the image. Please refer to my <a href="../xamarin-forms-video-trimmer/">previous post on <strong><em>Xamarin.Forms.VideoTrimmer</em></strong></a> on how I have used them.</p>

<p><em>Happy Coding :-)</em></p>


    </div>

    
<hr>

<aside id="comments" class="disqus">
  <h3><i class="icon icon-comments-o"></i> Comments</h3>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function() {
      this.page.url = 'http://sreerajpr.com/blogs/xamarin-forms-photo-collage-skiasharp/';
      this.page.identifier = '/blogs/Xamarin.Forms-Photo-Collage-Skiasharp';
    };
    (function() {
      var d = document,
      s = d.createElement('script');
      s.src = '//sreeraj-p-r.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</aside>


  </div>

</article>

  </div>
</main>

<footer class="site-footer">
  <div class="container">
    <ul class="social">
  <li><a href="https://github.com/sreerajpr" target="_blank"><i class="icon icon-github"></i></a></li>
  <li><a href="https://www.linkedin.com/in/sreeraj-p-r-360b125b/" target="_blank"><i class="icon icon-linkedin"></i></a></li>
  <li><a href="https://facebook.com/sreerajpr" target="_blank"><i class="icon icon-facebook"></i></a></li>
  <li><a href="mailto:sreerajpr.mec@gmail.com" target="_blank"><i class="icon icon-mail"></i></a></li>
</ul>
    <p class="txt-medium-gray">
      <small>&copy;2020 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small>
    </p>
  </div>
</footer>


</body>
</html>
